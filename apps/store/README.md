# 店舗POS向けアプリ

店舗スタッフ向けのアプリケーションです。注文受付、調理管理、配膳管理、会計処理を行います。

## 機能概要

店舗の日常オペレーションを支援するPOS機能を提供します。

## 技術スタック

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Authentication**: JWT (localstorage)
- **Real-time Updates**: Polling
- **PWA**: オフライン対応（実装済み）

## セットアップ

### 開発サーバー起動

```bash
# 店舗POSアプリのみ起動
pnpm -F store dev

# または全アプリ起動
pnpm dev
```

アプリは http://localhost:3003 で起動します。

## ✅ 完了済み（基本機能）

### 認証
- [x] ログイン (`/login`)
- [x] JWT認証
- [x] セッション管理

### 注文作成 (`/order`)
- [x] メニュー一覧表示
- [x] メニュー選択
- [x] テーブル番号入力
- [x] 注文送信
- [x] カート機能

### 厨房ディスプレイ (`/kitchen`)
- [x] 注文キュー管理
- [x] ステータス更新（待機中→調理中→調理完了→配膳済み）
- [x] 注文詳細表示
- [x] リアルタイム更新

### テーブル管理 (`/tables`)
- [x] テーブル一覧表示
- [x] テーブル状態表示（空席・使用中）
- [x] 顧客案内時のセッション作成
- [x] 人数入力機能
- [x] 30秒自動更新
- [x] ビジュアルテーブルマップ表示
- [x] マップ/リスト表示切替
- [x] テーブル状態の色分け（緑=空席、赤=使用中）
- [x] テーブル形状設定（正方形・長方形・円形）

### 会計 (`/payment`)
- [x] テーブルセッション別会計
- [x] 合計金額表示
- [x] 会計処理
- [x] セッション終了処理
- [x] 会計履歴表示

### 店舗選択 (`/select-store`)
- [x] ログイン後の店舗選択画面
- [x] 店舗一覧表示
- [x] 店舗切り替え機能（ドロップダウン）
- [x] 選択した店舗情報の保存

### エラーハンドリング
- [x] ネットワーク状態監視機能
- [x] オフライン時の通知バー表示
- [x] API呼び出しの自動リトライ（指数バックオフ）
- [x] エラートースト通知コンポーネント
- [x] リトライ可能エラーの判定（500番台）

### PWA対応
- [x] Service Worker自動生成（next-pwa）
- [x] オフライン動作サポート
- [x] マニフェストファイル設定
- [x] ホーム画面に追加可能
- [x] オフラインフォールバックページ
- [x] 自動再接続検知
- [x] アグレッシブキャッシング設定
- [ ] アイコン画像準備（192x192、512x512）※手動で追加必要

### プリンター連携
- [x] ブラウザベース印刷実装（window.print）
- [x] 厨房チケット自動印刷（注文作成時）
- [x] 印刷データ生成API（PrintService）
- [x] 印刷テンプレート管理（デフォルト80mm幅）
- [x] 印刷履歴ログ記録
- [x] PrintKitchenTicketコンポーネント
- [ ] ネットワークプリンター対応（将来）
- [ ] レシート印刷（将来）

### 売上日報
- [x] 日別売上レポート表示（`/reports/daily`）
- [x] ReportService実装（Payment.status基準集計）
- [x] 売上合計・会計件数・来客数・平均客単価
- [x] 支払い方法別内訳
- [x] TOP商品一覧
- [x] 時間帯別売上データ（API）
- [x] 日付選択機能
- [ ] 日次締め処理
- [ ] レポート印刷
- [ ] 月別サマリー表示（将来）

### アクティビティログ・監査ログ
- [x] アクティビティログ閲覧 (`/logs`)
- [x] 自店舗のログのみ閲覧
- [x] フィルター（アクションタイプ・日付範囲）
- [x] ページネーション（50件/ページ）
- [x] ログ詳細表示
- [x] スタッフ操作履歴追跡
- [x] 顧客行動ログ記録

**記録される操作ログ（Storeアプリ）**:
- ✅ **認証**: ログイン成功・失敗・ログアウト
- ✅ **注文管理**:
  - 注文作成（注文番号・金額・商品数・テーブルID）
  - 調理開始（注文番号・開始時刻）
  - 調理完了（注文番号・完了時刻）
  - 配膳完了（注文番号・配膳時刻）
- ✅ **決済管理**:
  - 決済完了（決済方法・金額・セッションID）
  - 決済失敗（決済方法・金額・失敗理由）
- ✅ **テーブルセッション**:
  - セッション開始（テーブル番号・人数・開始時刻）
  - セッション終了（テーブル番号・滞在時間・合計金額）
- 🔍 **閲覧可能**: 自店舗のログのみ
  - スタッフの操作履歴
  - 顧客の行動ログ（QRログイン・メニュー閲覧）

## 今後の実装予定（拡張機能）

### 🎨 優先度：中

#### 1. プリンター連携（高度な機能）
- [ ] ネットワークプリンター対応（ESC/POS）
- [ ] IP指定での自動印刷
- [ ] プリンター設定管理UI
- [ ] 厨房プリンター自動出力
- [ ] レシートプリンター連携
- [ ] 印刷設定管理

---

### 📊 優先度：低

#### 2. 在庫確認
- [ ] リアルタイム在庫確認
- [ ] 品切れ通知
- [ ] 在庫アラート

#### 3. スタッフ機能拡張
- [ ] シフト確認
- [ ] 勤怠打刻
- [ ] メッセージング機能

## ライセンス

このプロジェクトは開発中です。
